<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>問診</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
    <style type="text/css">
        .label_left {
            display: inline-block;
            width: 100%;
            border-left: solid 5px #5250e0;
            padding-left: 15px;
            vertical-align: top;
            margin-bottom: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <H2 style="text-align:center;">問診</H2>
    <form class="w-75 mx-auto">
        <div id="page01">
            <p class="label_left" name="name">名前</p>
            <div style="margin-bottom: 20px; margin-left: 20px;">
                <input class="form-control w-100 mt-1" id="name" name="page01" placeholder="" required>
            </div>
            <p class="label_left" name="birthday">生年月日</p>
            <div style="margin-bottom: 20px; margin-left: 20px;">
                <input type="date" id="birthday" name="page01" required>
            </div>
            <p class="label_left" name="height">身長</p>
            <div style="margin-bottom: 20px; margin-left: 20px;">
                <input class="form-control w-100 mt-1" id="height" name="page01" style="width:150px!important;" required>cm
            </div>
            <p class="label_left" name="weight">体重</p>
            <div style="margin-bottom: 20px; margin-left: 20px;">
                <input class="form-control w-100 mt-1" id="weight" name="page01" style="width:150px!important;" required>kg
            </div>
            <p class="label_left" name="bodyTemperature">本日の体温</p>
            <div style="margin-bottom: 20px; margin-left: 20px;">
                <input class="form-control w-100 mt-1" id="bodyTemperature" name="page01" style="width:150px!important;" required>℃
            </div>
            <button type="button" class="btn btn-primary" onclick="goPage2()" style="margin-top: 20px;">次の質問へ進む</button>
            <input type="submit" class="mt-4 btn btn-primary" name="page01" value="送信" style="display:block;">
            <div style="text-align: center;">
                <button type="button" class="btn" id="button1" style="text-align: center;" disabled>1</button>
                <button type="button" class="btn" onclick="goPage2()" id="button2" style="text-align: center; color:blue;">2</button>
            </div>
        </div>
    </form>
    <form class="w-75 mx-auto">
        <div id="page02" style="display: none;">
            <p class="label_left">Q01.現在、aからcの薬の使用の有無</p><br>
            <p class="label_left" style="border-left:none; padding-left: 10px;">a.血圧を下げる薬</p>
            <div style="margin-left: 20px;">
                <input type="radio" id="Q1-1Yes" name="Q1-1" value="はい" required>
                <label for="Q1-1Yes">はい</label>
                <input type="radio" id="Q1-1No" name="Q1-1" value="いいえ" required>
                <label for="Q1-1No">いいえ</label>
            </div>
            <p class="label_left" style="border-left:none; padding-left: 10px;">b.インスリン注射又は血統を下げる薬</p>
            <div style="margin-left: 20px;">
                <input type="radio" id="Q1-2Yes" name="Q1-2" value="はい" required>
                <label for="Q1-2Yes">はい</label>
                <input type="radio" id="Q1-2No" name="Q1-2" value="いいえ" required>
                <label for="Q1-2No">いいえ</label>
            </div>
            <p class="label_left" style="border-left:none; padding-left: 10px;">c.コレステロールを下げる薬</p>
            <div style="margin-left: 20px;">
                <input type="radio" id="Q1-3Yes" name="Q1-3" value="はい" required>
                <label for="Q1-3Yes">はい</label>
                <input type="radio" id="Q1-3No" name="Q1-3" value="いいえ" required>
                <label for="Q1-3No">いいえ</label>
            </div>
            <p class="label_left">Q02.医師から、脳卒中(脳出血、脳梗塞等)にかかっているといわれたり、治療を受けたことがありますか？</p>
            <div style="margin-left: 20px;">
                <input type="radio" id="Q2Yes" name="Q2" value="はい" required>
                <label for="Q2Yes">はい</label>
                <input type="radio" id="Q2No" name="Q2" value="いいえ" required>
                <label for="Q2No">いいえ</label>
            </div>
            <p class="label_left">Q03.医師から、心臓病（狭心症、心筋梗塞等）にかかっているといわれたり、治療を受けたことがありますか。</p>
            <div style="margin-left: 20px;">
                <input type="radio" id="Q3Yes" name="Q3" value="はい" required>
                <label for="Q3Yes">はい</label>
                <input type="radio" id="Q3No" name="Q3" value="いいえ" required>
                <label for="Q3No">いいえ</label>
            </div>
            <p class="label_left">Q04.医師から、慢性の腎不全にかかっているといわれたり、治療（人工透析）を受けたことがありますか。</p>
            <div style="margin-left: 20px;">
                <input type="radio" id="Q4Yes" name="Q4" value="はい" required>
                <label for="Q4Yes">はい</label>
                <input type="radio" id="Q4No" name="Q4" value="いいえ" required>
                <label for="Q4No">いいえ</label>
            </div>
            <p class="label_left">Q05.医師から、貧血といわれたことがある。</p>
            <div style="margin-left: 20px;">
                <input type="radio" id="Q5Yes" name="Q5" value="はい" required>
                <label for="Q5Yes">はい</label>
                <input type="radio" id="Q5No" name="Q5" value="いいえ" required>
                <label for="Q5No">いいえ</label>
            </div>
            <p class="label_left">その他質問事項等</p>
            <div style="margin-left: 20px;">
                <input id="sonota" name="sonota" placeholder="">
            </div>
            <button type="button" class="btn btn-primary" onclick="backPage1()" style="margin-top: 20px;">前の質問へ戻る</button>
            <input type="submit" class="mt-4 btn btn-primary" value="送信" style="display:block;">
            <div style="text-align:center;">
                <button type="button" class="btn" onclick="backPage1()" id="button1" style="text-align: center; color:blue;">1</button>
                <button type="button" class="btn" id="button2" style="text-align: center;" disabled>2</button>
            </div>
        </div>
    </form>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        window.onload = function () {
            const page01 = document.getElementById('page01');
            page01.style.display = 'block';
            page02.style.display = 'none';
        }

        $(document).ready(function () {
            const liffId = "1660856020-9r4xpNbr";
            initializeLiff(liffId);
        })

        function initializeLiff(liffId) {
            liff.init({
                liffId: liffId
            }).then(() => {
                initializeApp();
            }).catch((err) => {
                console.log('LIFF Initialization failed ', err);
            });
        }

        function sendText(text) {
            liff.sendMessages([
                {
                    'type': 'text',
                    'text': text
                }
            ]).then(function () {
                liff.closeWindow();
            }).catch(function (error) {
                window.alert('Failed to send message ' + error);
            });
        }


        const params = (new URL(document.location)).searchParams;
        const key = params.get('key');

        $(function () {
            $('form').submit(function () {
                // Page1
                const name = document.getElementById('name').value;
                const birthday = document.getElementById('birthday').value;
                let birthday_slash = '';
                if (birthday != '' && birthday != undefined) {
                    birthday_slash = birthday.replace(/-/g, '/');
                }
                const height = document.getElementById('height').value;
                const weight = document.getElementById('weight').value;
                const bodyTemperature = document.getElementById('bodyTemperature').value;
                const sonota = document.getElementById('sonota').value;
                // Page2
                const q1Text = 'Q01.現在、aからcの薬の使用の有無';
                const q1_1Text = 'a.血圧を下げる薬';
                const q1_2Text = 'b.インスリン注射又は血統を下げる薬';
                const q1_3Text = 'c.コレステロールを下げる薬';
                const q2Text = 'Q02.医師から、脳卒中(脳出血、脳梗塞等)にかかっているといわれたり、治療を受けたことがありますか？';
                const q3Text = 'Q03.医師から、心臓病（狭心症、心筋梗塞等）にかかっているといわれたり、治療を受けたことがありますか。';
                const q4Text = 'Q04.医師から、慢性の腎不全にかかっているといわれたり、治療（人工透析）を受けたことがありますか。';
                const q5Text = 'Q05.医師から、貧血といわれたことがある。';
                const q1_1List = document.getElementsByName('Q1-1');
                let q1_1 = '';
                for (let i = 0; i < q1_1List.length; i++) {
                    if (q1_1List[i].checked) {
                        q1_1 = q1_1List[i].value;
                    }
                }
                const q1_2List = document.getElementsByName('Q1-2');
                let q1_2 = '';
                for (let i = 0; i < q1_2List.length; i++) {
                    if (q1_2List[i].checked) {
                        q1_2 = q1_2List[i].value;
                    }
                }
                const q1_3List = document.getElementsByName('Q1-3');
                let q1_3 = '';
                for (let i = 0; i < q1_3List.length; i++) {
                    if (q1_3List[i].checked) {
                        q1_3 = q1_3List[i].value;
                    }
                }
                const q2List = document.getElementsByName('Q2');
                let q2 = '';
                for (let i = 0; i < q2List.length; i++) {
                    if (q2List[i].checked) {
                        q2 = q2List[i].value;
                    }
                }
                const q3List = document.getElementsByName('Q3');
                let q3 = '';
                for (let i = 0; i < q3List.length; i++) {
                    if (q3List[i].checked) {
                        q3 = q3List[i].value;
                    }
                }
                const q4List = document.getElementsByName('Q4');
                let q4 = '';
                for (let i = 0; i < q4List.length; i++) {
                    if (q4List[i].checked) {
                        q4 = q4List[i].value;
                    }
                }
                const q5List = document.getElementsByName('Q5');
                let q5 = '';
                for (let i = 0; i < q5List.length; i++) {
                    if (q5List[i].checked) {
                        q5 = q5List[i].value;
                    }
                }
                const msg = `問診記入\n名前：${name}\n生年月日：${birthday_slash}\n身長：${height}cm\n体重：${weight}kg\n体温：${bodyTemperature}℃
\n${q1Text}\n${q1_1Text}\n${q1_1}\n\n${q1_2Text}\n${q1_2}\n\n${q1_3Text}\n${q1_3}\n\n${q2Text}\n${q2}\n\n${q3Text}\n${q3}\n\n${q4Text}\n${q4}\n\n${q5Text}\n${q5}\n\nその他質問事項等：${sonota}`;

                if (name != '' &&
                    name != undefined &&
                    birthday != '' &&
                    birthday != undefined &&
                    height != '' &&
                    height != undefined &&
                    weight != '' &&
                    weight != undefined &&
                    bodyTemperature != '' &&
                    bodyTemperature != undefined &&
                    sonota != '' &&
                    sonota != undefined &&
                    q1_1 != '' &&
                    q1_1 != undefined &&
                    q1_2 != '' &&
                    q1_2 != undefined &&
                    q1_3 != '' &&
                    q1_3 != undefined &&
                    q2 != '' &&
                    q2 != undefined &&
                    q3 != '' &&
                    q3 != undefined &&
                    q4 != '' &&
                    q4 != undefined &&
                    q5 != '' &&
                    q5 != undefined) {
                    sendText(msg);
                } else {
                    alert('未入力の項目があります。');
                }

                return false;
            });
        });
        function backPage1() {
            page01.style.display = 'block';
            page02.style.display = 'none';
        }
        // 2ページ目に遷移する
        function goPage2() {
            page01.style.display = 'none';
            page02.style.display = 'block';
        }
    </script>

</body>
</html>